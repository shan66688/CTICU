---
title: "Descriptive"
author: "Mingxu Shan"
date: "3/10/2019"
output: github_document
---
```{r}
library(tidyverse)
library(readxl)
```

```{r}
rawdata <- read_excel("data/Master worksheet CTICU extubation times .xls", 
    sheet = "Master data", col_types = c("numeric", 
        "numeric", "text", "date", "date", 
        "date", "date", "text", "text", "numeric", 
        "numeric", "numeric", "numeric", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "numeric", 
        "numeric", "numeric", "text", "text", 
        "text", "text", "text", "text", "text", 
        "text", "text", "text", "text", "text", 
        "numeric", "text", "numeric", "text", 
        "numeric", "numeric", "text", "text", 
        "text", "text", "date", "date", 
        "date", "date", "date", 
        "text", "numeric", "text", "numeric", 
        "numeric", "text", "numeric", "text", 
        "text", "numeric", "numeric", "text", 
        "text", "text", "text", "text", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric"))
```




```{r descriptive data}
desdata <- rawdata %>% 
  separate("Surgery duration", into = c("Sdate", "Stime"), sep= " ") %>%
  separate("OR Exit Date And Time", into = c("OREdate", "OREtime"), sep= " ") %>%
  separate("OREtime", into = c("OREhour", "OREmin","OREsec"), sep= ":") %>%
  separate("Stime", into = c("Shour","Smin","Ssec"), sep= ":") %>% 
  mutate (Shour=as.numeric(Shour), Smin=as.numeric(Smin), Stime = Shour+ (Smin/60),
          OREhour = as.numeric(OREhour) ,
          period = ifelse (OREhour <18 & OREhour >=7,  "P1", "P2"),
          Ethnicity = NA,
         
          
          Reintub = coalesce(`Re-intubated During Hospital Stay`, `Postop Intubation/Reintubation During Hospital Stay`)
          ) %>%

  rename(age = "Patient Age", 
         sex = "Sex", 
         BMI = "BMI", 
         PMM = "Predicted Morbidity or Mortality", 
         PRM = "Predicted Risk of Mortality", 
         PPV = "Predicted Prolonged Ventilation", 
         Reop = "Incidence",
         Urgent = "Status",
         Sug_Dur = "Stime",
         Pri_MI = "Prior MI",
         HF_w2w = "Heart Failure within 2 weeks",
         NYHA = "Classification-NYHA",
         smoker = "RF-Tobacco Use",
         lung = "RF-Chronic Lung Disease",
         PFT = "RF-Pulmonary Function Test",
         FEV = "RF-Forced Expiratory Volume Predicted",
         DLCOT = "DLCO Test Performed",
         DLCO = "DLCO Predicted",
         RFD = "RF-Renal Fail-Dialysis",
         PAD = "RF-Peripheral Arterial Disease",
         IHV = "Initial Hours Ventilated",
         Post_pneu = "Post-Op-Pulm-Pneumonia", 
         Post_throm = "Post-Op-Venous Thromboembolism-VTE",
         Post_stroke = "Post-Op-Neuro-Stroke Perm"  ,
         Re_ICU = "Readmission to ICU" ,
         Hos_LOS = "LOS-Admit-Discharge" , 
         ICU_LOS = "Total Hrs ICU",
         Mor_disc = "Mort-DC Status"  
         ) %>% 
  select(age,
       sex,
       Ethnicity,
       BMI, 
       PMM , 
       PRM , 
       PPV,
       Reop ,
       Urgent ,
       Sug_Dur ,
       Pri_MI ,
       HF_w2w ,
       NYHA ,
       smoker,
       lung,
       PFT,
       FEV ,
       DLCOT ,
       DLCO,
       RFD ,
       PAD,
       OREhour,
       IHV,
       period,
       Reintub, 
       Post_pneu, 
       Post_throm ,
       Post_stroke ,
       Re_ICU , 
       Hos_LOS, 
       ICU_LOS, 
       Mor_disc
       
       )
  
        


# combine ethnicity

desdata$Ethnicity[rawdata$`Race - White` == "Yes"] = "White"
desdata$Ethnicity[rawdata$`Race - Black / African American` == "Yes"] = "Black"
desdata$Ethnicity[rawdata$`Race - Asian` == "Yes"] = "Asian"
desdata$Ethnicity[rawdata$`Race - American Indian / Alaskan Native` == "Yes"] = "American Indian"
desdata$Ethnicity[rawdata$`Race - Native Hawaiian / Pacific Islander` == "Yes"] = "Hawaiian"
desdata$Ethnicity[rawdata$`Race - Other` == "Yes"] = "Other"
desdata$Ethnicity[rawdata$`Race Documented` == "No"] = "No document"
```





```{r}
names(rawdata)
names(desdata)
```
#Categorical 

```{r sex descriptive}
#desdata$sex[desdata$sex == "Not documented"] <- NA
length(desdata$sex)
sum(is.na(desdata$sex))
sum(is.na(desdata$sex)) / length(desdata$sex)
table(desdata$sex)

#table(desdata$sex) / length(desdata$sex)
paste(round(100*(table(desdata$sex) / 861), 2), "%", sep="")

length(desdata$sex[desdata$period == "P1"])
length(desdata$sex[desdata$period == "P2"])

sum(is.na(desdata$sex[desdata$period == "P1"]))
sum(is.na(desdata$sex[desdata$period == "P2"]))

table(desdata$sex[desdata$period == "P1"]) 
table(desdata$sex[desdata$period == "P2"]) 

#table(desdata$sex[desdata$period == "P1"]) / length(desdata$sex[desdata$period == "P1"])
paste(round(100*(table(desdata$sex[desdata$period == "P1"]) / length(desdata$sex[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$sex[desdata$period == "P2"]) / length(desdata$sex[desdata$period == "P2"])
paste(round(100*(table(desdata$sex[desdata$period == "P2"]) / length(desdata$sex[desdata$period == "P2"])), 2), "%", sep="")


```

```{r sex descriptive}
#desdata$sex[desdata$sex == "Not documented"] <- NA
length(desdata$sex)
sum(is.na(desdata$sex))
sum(is.na(desdata$sex)) / length(desdata$sex)
table(desdata$sex)

#table(desdata$sex) / length(desdata$sex)
paste(round(100*(table(desdata$sex) / 861), 2), "%", sep="")

length(desdata$sex[desdata$period == "P1"])
length(desdata$sex[desdata$period == "P2"])

sum(is.na(desdata$sex[desdata$period == "P1"]))
sum(is.na(desdata$sex[desdata$period == "P2"]))

table(desdata$sex[desdata$period == "P1"]) 
table(desdata$sex[desdata$period == "P2"]) 

#table(desdata$sex[desdata$period == "P1"]) / length(desdata$sex[desdata$period == "P1"])
paste(round(100*(table(desdata$sex[desdata$period == "P1"]) / length(desdata$sex[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$sex[desdata$period == "P2"]) / length(desdata$sex[desdata$period == "P2"])
paste(round(100*(table(desdata$sex[desdata$period == "P2"]) / length(desdata$sex[desdata$period == "P2"])), 2), "%", sep="")
chisq.test(desdata$sex,desdata$period, correct = FALSE)

```

```{r Reop descriptive}
#desdata$Reop[desdata$Reop == "Not documented"] <- NA
length(desdata$Reop)
sum(is.na(desdata$Reop))
sum(is.na(desdata$Reop)) / length(desdata$Reop)
table(desdata$Reop)

#table(desdata$Reop) / length(desdata$Reop)
paste(round(100*(table(desdata$Reop) / 861), 2), "%", sep="")

length(desdata$Reop[desdata$period == "P1"])
length(desdata$Reop[desdata$period == "P2"])

sum(is.na(desdata$Reop[desdata$period == "P1"]))
sum(is.na(desdata$Reop[desdata$period == "P2"]))

table(desdata$Reop[desdata$period == "P1"]) 
table(desdata$Reop[desdata$period == "P2"]) 

#table(desdata$Reop[desdata$period == "P1"]) / length(desdata$Reop[desdata$period == "P1"])
paste(round(100*(table(desdata$Reop[desdata$period == "P1"]) / length(desdata$Reop[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$Reop[desdata$period == "P2"]) / length(desdata$Reop[desdata$period == "P2"])
paste(round(100*(table(desdata$Reop[desdata$period == "P2"]) / length(desdata$Reop[desdata$period == "P2"])), 2), "%", sep="")

desdata <- desdata %>%  mutate(Reop = ifelse(Reop == "First cardiovascular surgery","Yes", "No")) 
chisq.test(desdata$Reop,desdata$period, correct = FALSE)
```


```{r Urgent descriptive}
#desdata$Urgent[desdata$Urgent == "Not documented"] <- NA
length(desdata$Urgent)
sum(is.na(desdata$Urgent))
sum(is.na(desdata$Urgent)) / length(desdata$Urgent)
table(desdata$Urgent)

#table(desdata$Urgent) / length(desdata$Urgent)
paste(round(100*(table(desdata$Urgent) / 861), 2), "%", sep="")

length(desdata$Urgent[desdata$period == "P1"])
length(desdata$Urgent[desdata$period == "P2"])

sum(is.na(desdata$Urgent[desdata$period == "P1"]))
sum(is.na(desdata$Urgent[desdata$period == "P2"]))

table(desdata$Urgent[desdata$period == "P1"]) 
table(desdata$Urgent[desdata$period == "P2"]) 

#table(desdata$Urgent[desdata$period == "P1"]) / length(desdata$Urgent[desdata$period == "P1"])
paste(round(100*(table(desdata$Urgent[desdata$period == "P1"]) / length(desdata$Urgent[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$Urgent[desdata$period == "P2"]) / length(desdata$Urgent[desdata$period == "P2"])
paste(round(100*(table(desdata$Urgent[desdata$period == "P2"]) / length(desdata$Urgent[desdata$period == "P2"])), 2), "%", sep="")


chisq.test(desdata$Urgent,desdata$period, correct = FALSE)
```


```{r Pri_MI descriptive}
desdata$Pri_MI[desdata$Pri_MI == "Unknown"] <- NA
length(desdata$Pri_MI)
sum(is.na(desdata$Pri_MI))
sum(is.na(desdata$Pri_MI)) / length(desdata$Pri_MI)
table(desdata$Pri_MI)

#table(desdata$Pri_MI) / length(desdata$Pri_MI)
paste(round(100*(table(desdata$Pri_MI) / 861), 2), "%", sep="")

length(desdata$Pri_MI[desdata$period == "P1"])
length(desdata$Pri_MI[desdata$period == "P2"])

sum(is.na(desdata$Pri_MI[desdata$period == "P1"]))
sum(is.na(desdata$Pri_MI[desdata$period == "P2"]))

table(desdata$Pri_MI[desdata$period == "P1"]) 
table(desdata$Pri_MI[desdata$period == "P2"]) 

#table(desdata$Pri_MI[desdata$period == "P1"]) / length(desdata$Pri_MI[desdata$period == "P1"])
paste(round(100*(table(desdata$Pri_MI[desdata$period == "P1"]) / length(desdata$Pri_MI[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$Pri_MI[desdata$period == "P2"]) / length(desdata$Pri_MI[desdata$period == "P2"])
paste(round(100*(table(desdata$Pri_MI[desdata$period == "P2"]) / length(desdata$Pri_MI[desdata$period == "P2"])), 2), "%", sep="")

table(desdata$Pri_MI,desdata$period)
chisq.test(desdata$Pri_MI,desdata$period, correct = FALSE)
```


```{r HF_w2w descriptive}
desdata$HF_w2w[desdata$HF_w2w == "Unknown"] <- NA
length(desdata$HF_w2w)
sum(is.na(desdata$HF_w2w))
sum(is.na(desdata$HF_w2w)) / length(desdata$HF_w2w)
table(desdata$HF_w2w)

#table(desdata$HF_w2w) / length(desdata$HF_w2w)
paste(round(100*(table(desdata$HF_w2w) / 861), 2), "%", sep="")

length(desdata$HF_w2w[desdata$period == "P1"])
length(desdata$HF_w2w[desdata$period == "P2"])

sum(is.na(desdata$HF_w2w[desdata$period == "P1"]))
sum(is.na(desdata$HF_w2w[desdata$period == "P2"]))

table(desdata$HF_w2w[desdata$period == "P1"]) 
table(desdata$HF_w2w[desdata$period == "P2"]) 

#table(desdata$HF_w2w[desdata$period == "P1"]) / length(desdata$HF_w2w[desdata$period == "P1"])
paste(round(100*(table(desdata$HF_w2w[desdata$period == "P1"]) / length(desdata$HF_w2w[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$HF_w2w[desdata$period == "P2"]) / length(desdata$HF_w2w[desdata$period == "P2"])
paste(round(100*(table(desdata$HF_w2w[desdata$period == "P2"]) / length(desdata$HF_w2w[desdata$period == "P2"])), 2), "%", sep="")
chisq.test(desdata$HF_w2w,desdata$period, correct = FALSE)
```


```{r NYHA descriptive}
#desdata$NYHA[desdata$NYHA == "Not documented"] <- NA
length(desdata$NYHA)
sum(is.na(desdata$NYHA))
sum(is.na(desdata$NYHA)) / length(desdata$NYHA)
table(desdata$NYHA)

#table(desdata$NYHA) / length(desdata$NYHA)
paste(round(100*(table(desdata$NYHA) / 861), 2), "%", sep="")

length(desdata$NYHA[desdata$period == "P1"])
length(desdata$NYHA[desdata$period == "P2"])

sum(is.na(desdata$NYHA[desdata$period == "P1"]))
sum(is.na(desdata$NYHA[desdata$period == "P2"]))

table(desdata$NYHA[desdata$period == "P1"]) 
table(desdata$NYHA[desdata$period == "P2"]) 

#table(desdata$NYHA[desdata$period == "P1"]) / length(desdata$NYHA[desdata$period == "P1"])
paste(round(100*(table(desdata$NYHA[desdata$period == "P1"]) / length(desdata$NYHA[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$NYHA[desdata$period == "P2"]) / length(desdata$NYHA[desdata$period == "P2"])
paste(round(100*(table(desdata$NYHA[desdata$period == "P2"]) / length(desdata$NYHA[desdata$period == "P2"])), 2), "%", sep="")
```

```{r smoker descriptive}
#desdata$smoker[desdata$smoker == "Not documented"] <- NA
length(desdata$smoker)
sum(is.na(desdata$smoker))
sum(is.na(desdata$smoker)) / length(desdata$smoker)
table(desdata$smoker)

#table(desdata$smoker) / length(desdata$smoker)
paste(round(100*(table(desdata$smoker) / 861), 2), "%", sep="")

length(desdata$smoker[desdata$period == "P1"])
length(desdata$smoker[desdata$period == "P2"])

sum(is.na(desdata$smoker[desdata$period == "P1"]))
sum(is.na(desdata$smoker[desdata$period == "P2"]))

table(desdata$smoker[desdata$period == "P1"]) 
table(desdata$smoker[desdata$period == "P2"]) 

#table(desdata$smoker[desdata$period == "P1"]) / length(desdata$smoker[desdata$period == "P1"])
paste(round(100*(table(desdata$smoker[desdata$period == "P1"]) / length(desdata$smoker[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$smoker[desdata$period == "P2"]) / length(desdata$smoker[desdata$period == "P2"])
paste(round(100*(table(desdata$smoker[desdata$period == "P2"]) / length(desdata$smoker[desdata$period == "P2"])), 2), "%", sep="")

```

```{r lung descriptive}
#desdata$lung[desdata$lung == "Not documented"] <- NA
length(desdata$lung)
sum(is.na(desdata$lung))
sum(is.na(desdata$lung)) / length(desdata$lung)
table(desdata$lung)

#table(desdata$lung) / length(desdata$lung)
paste(round(100*(table(desdata$lung) / 861), 2), "%", sep="")

length(desdata$lung[desdata$period == "P1"])
length(desdata$lung[desdata$period == "P2"])

sum(is.na(desdata$lung[desdata$period == "P1"]))
sum(is.na(desdata$lung[desdata$period == "P2"]))

table(desdata$lung[desdata$period == "P1"]) 
table(desdata$lung[desdata$period == "P2"]) 

#table(desdata$lung[desdata$period == "P1"]) / length(desdata$lung[desdata$period == "P1"])
paste(round(100*(table(desdata$lung[desdata$period == "P1"]) / length(desdata$lung[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$lung[desdata$period == "P2"]) / length(desdata$lung[desdata$period == "P2"])
paste(round(100*(table(desdata$lung[desdata$period == "P2"]) / length(desdata$lung[desdata$period == "P2"])), 2), "%", sep="")
```


```{r PFT descriptive}
#desdata$PFT[desdata$PFT == "Not documented"] <- NA
length(desdata$PFT)
sum(is.na(desdata$PFT))
sum(is.na(desdata$PFT)) / length(desdata$PFT)
table(desdata$PFT)

#table(desdata$PFT) / length(desdata$PFT)
paste(round(100*(table(desdata$PFT) / 861), 2), "%", sep="")

length(desdata$PFT[desdata$period == "P1"])
length(desdata$PFT[desdata$period == "P2"])

sum(is.na(desdata$PFT[desdata$period == "P1"]))
sum(is.na(desdata$PFT[desdata$period == "P2"]))

table(desdata$PFT[desdata$period == "P1"]) 
table(desdata$PFT[desdata$period == "P2"]) 

#table(desdata$PFT[desdata$period == "P1"]) / length(desdata$PFT[desdata$period == "P1"])
paste(round(100*(table(desdata$PFT[desdata$period == "P1"]) / length(desdata$PFT[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$PFT[desdata$period == "P2"]) / length(desdata$PFT[desdata$period == "P2"])
paste(round(100*(table(desdata$PFT[desdata$period == "P2"]) / length(desdata$PFT[desdata$period == "P2"])), 2), "%", sep="")
```
```{r DLCOT descriptive}
#desdata$DLCOT[desdata$DLCOT == "Not documented"] <- NA
length(desdata$DLCOT)
sum(is.na(desdata$DLCOT))
sum(is.na(desdata$DLCOT)) / length(desdata$DLCOT)
table(desdata$DLCOT)

#table(desdata$DLCOT) / length(desdata$DLCOT)
paste(round(100*(table(desdata$DLCOT) / 861), 2), "%", sep="")

length(desdata$DLCOT[desdata$period == "P1"])
length(desdata$DLCOT[desdata$period == "P2"])

sum(is.na(desdata$DLCOT[desdata$period == "P1"]))
sum(is.na(desdata$DLCOT[desdata$period == "P2"]))

table(desdata$DLCOT[desdata$period == "P1"]) 
table(desdata$DLCOT[desdata$period == "P2"]) 

#table(desdata$DLCOT[desdata$period == "P1"]) / length(desdata$DLCOT[desdata$period == "P1"])
paste(round(100*(table(desdata$DLCOT[desdata$period == "P1"]) / length(desdata$DLCOT[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$DLCOT[desdata$period == "P2"]) / length(desdata$DLCOT[desdata$period == "P2"])
paste(round(100*(table(desdata$DLCOT[desdata$period == "P2"]) / length(desdata$DLCOT[desdata$period == "P2"])), 2), "%", sep="")
```

```{r RFD descriptive}
#desdata$RFD[desdata$RFD == "Not documented"] <- NA
length(desdata$RFD)
sum(is.na(desdata$RFD))
sum(is.na(desdata$RFD)) / length(desdata$RFD)
table(desdata$RFD)

#table(desdata$RFD) / length(desdata$RFD)
paste(round(100*(table(desdata$RFD) / 861), 2), "%", sep="")

length(desdata$RFD[desdata$period == "P1"])
length(desdata$RFD[desdata$period == "P2"])

sum(is.na(desdata$RFD[desdata$period == "P1"]))
sum(is.na(desdata$RFD[desdata$period == "P2"]))

table(desdata$RFD[desdata$period == "P1"]) 
table(desdata$RFD[desdata$period == "P2"]) 

#table(desdata$RFD[desdata$period == "P1"]) / length(desdata$RFD[desdata$period == "P1"])
paste(round(100*(table(desdata$RFD[desdata$period == "P1"]) / length(desdata$RFD[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$RFD[desdata$period == "P2"]) / length(desdata$RFD[desdata$period == "P2"])
paste(round(100*(table(desdata$RFD[desdata$period == "P2"]) / length(desdata$RFD[desdata$period == "P2"])), 2), "%", sep="")
```


```{r PAD descriptive}
#desdata$PAD[desdata$PAD == "Not documented"] <- NA
length(desdata$PAD)
sum(is.na(desdata$PAD))
sum(is.na(desdata$PAD)) / length(desdata$PAD)
table(desdata$PAD)

#table(desdata$PAD) / length(desdata$PAD)
paste(round(100*(table(desdata$PAD) / 861), 2), "%", sep="")

length(desdata$PAD[desdata$period == "P1"])
length(desdata$PAD[desdata$period == "P2"])

sum(is.na(desdata$PAD[desdata$period == "P1"]))
sum(is.na(desdata$PAD[desdata$period == "P2"]))

table(desdata$PAD[desdata$period == "P1"]) 
table(desdata$PAD[desdata$period == "P2"]) 

#table(desdata$PAD[desdata$period == "P1"]) / length(desdata$PAD[desdata$period == "P1"])
paste(round(100*(table(desdata$PAD[desdata$period == "P1"]) / length(desdata$PAD[desdata$period == "P1"])), 2), "%", sep="")

#table(desdata$PAD[desdata$period == "P2"]) / length(desdata$PAD[desdata$period == "P2"])
paste(round(100*(table(desdata$PAD[desdata$period == "P2"]) / length(desdata$PAD[desdata$period == "P2"])), 2), "%", sep="")
```


#Continuous
```{r age descriptive}
desdata$age[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$age[desdata$period == "P1"])
desdata$age[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$age[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$age[desdata$period == "P2"])
desdata$age[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$age %>% na.omit() %>% length()
summary(desdata$age)
desdata$age %>% na.omit() %>% sd()
```
```{r age t}
var.test(desdata$age[desdata$period == "P2"], desdata$age[desdata$period == "P1"])
t.test(x= desdata$age[desdata$period == "P1"], y = desdata$age[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```

```{r PMM descriptive}
desdata$PMM[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$PMM[desdata$period == "P1"])
desdata$PMM[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$PMM[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$PMM[desdata$period == "P2"])
desdata$PMM[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$PMM %>% na.omit() %>% length()
summary(desdata$PMM)
desdata$PMM %>% na.omit() %>% sd()
```

```{r PMM t}
var.test(desdata$PMM[desdata$period == "P2"], desdata$PMM[desdata$period == "P1"])
t.test(x= desdata$PMM[desdata$period == "P1"], y = desdata$PMM[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r PRM descriptive}
desdata$PRM[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$PRM[desdata$period == "P1"])
desdata$PRM[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$PRM[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$PRM[desdata$period == "P2"])
desdata$PRM[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$PRM %>% na.omit() %>% length()
summary(desdata$PRM)
desdata$PRM %>% na.omit() %>% sd()
```

```{r PRM t}
var.test(desdata$PRM[desdata$period == "P2"], desdata$PRM[desdata$period == "P1"])
t.test(x= desdata$PRM[desdata$period == "P1"], y = desdata$PRM[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```

```{r PRM descriptive}
desdata$PRM[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$PRM[desdata$period == "P1"])
desdata$PRM[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$PRM[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$PRM[desdata$period == "P2"])
desdata$PRM[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$PRM %>% na.omit() %>% length()
summary(desdata$PRM)
desdata$PRM %>% na.omit() %>% sd()
```

```{r PRM t}
var.test(desdata$PRM[desdata$period == "P2"], desdata$PRM[desdata$period == "P1"])
t.test(x= desdata$PRM[desdata$period == "P1"], y = desdata$PRM[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r PPV descriptive}
desdata$PPV[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$PPV[desdata$period == "P1"])
desdata$PPV[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$PPV[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$PPV[desdata$period == "P2"])
desdata$PPV[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$PPV %>% na.omit() %>% length()
summary(desdata$PPV)
desdata$PPV %>% na.omit() %>% sd()
```

```{r PPV t}
var.test(desdata$PPV[desdata$period == "P2"], desdata$PPV[desdata$period == "P1"])
t.test(x= desdata$PPV[desdata$period == "P1"], y = desdata$PPV[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```

```{r Sug_Dur descriptive}
desdata$Sug_Dur[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$Sug_Dur[desdata$period == "P1"])
desdata$Sug_Dur[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$Sug_Dur[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$Sug_Dur[desdata$period == "P2"])
desdata$Sug_Dur[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$Sug_Dur %>% na.omit() %>% length()
summary(desdata$Sug_Dur)
desdata$Sug_Dur %>% na.omit() %>% sd()
```

```{r Sug_Dur t}
var.test(desdata$Sug_Dur[desdata$period == "P2"], desdata$Sug_Dur[desdata$period == "P1"])
t.test(x= desdata$Sug_Dur[desdata$period == "P1"], y = desdata$Sug_Dur[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```


```{r FEV descriptive}
desdata$FEV[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$FEV[desdata$period == "P1"])
desdata$FEV[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$FEV[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$FEV[desdata$period == "P2"])
desdata$FEV[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$FEV %>% na.omit() %>% length()
summary(desdata$FEV)
desdata$FEV %>% na.omit() %>% sd()
```

```{r FEV t}
var.test(desdata$FEV[desdata$period == "P2"], desdata$FEV[desdata$period == "P1"])
t.test(x= desdata$FEV[desdata$period == "P1"], y = desdata$FEV[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```


```{r DLCO descriptive}
desdata$DLCO[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$DLCO[desdata$period == "P1"])
desdata$DLCO[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$DLCO[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$DLCO[desdata$period == "P2"])
desdata$DLCO[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$DLCO %>% na.omit() %>% length()
summary(desdata$DLCO)
desdata$DLCO %>% na.omit() %>% sd()
```

```{r DLCO t}
var.test(desdata$DLCO[desdata$period == "P2"], desdata$DLCO[desdata$period == "P1"])
t.test(x= desdata$DLCO[desdata$period == "P1"], y = desdata$DLCO[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```


```{r IHV descriptive}
desdata$IHV[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$IHV[desdata$period == "P1"])
desdata$IHV[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$IHV[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$IHV[desdata$period == "P2"])
desdata$IHV[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$IHV %>% na.omit() %>% length()
summary(desdata$IHV)
desdata$IHV %>% na.omit() %>% sd()
```
```{r IHV t}
var.test(desdata$IHV[desdata$period == "P2"], desdata$IHV[desdata$period == "P1"])
t.test(x= desdata$IHV[desdata$period == "P1"], y = desdata$IHV[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```



```{r IHV_24}
desdata <- desdata %>% mutate( IHV_24 = IHV)
desdata$IHV_24[desdata$IHV>24] = NA 

desdata$IHV_24[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$IHV_24[desdata$period == "P1"])
desdata$IHV_24[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$IHV_24[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$IHV_24[desdata$period == "P2"])
desdata$IHV_24[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$IHV_24 %>% na.omit() %>% length()
summary(desdata$IHV_24)
desdata$IHV_24 %>% na.omit() %>% sd()
```

```{r IHV_24 t}
var.test(desdata$IHV_24[desdata$period == "P2"], desdata$IHV_24[desdata$period == "P1"])
t.test(x= desdata$IHV_24[desdata$period == "P1"], y = desdata$IHV_24[desdata$period == "P2"], paired = FALSE, var.equal = TRUE, conf.level = 0.95)
```


```{r}

library(ggplot2)
theme_set(theme_classic())

hist(desdata$IHV_24, breaks = 12, plot = TRUE, freq = TRUE)

barplot(desdata$IHV_24,desdata$OREhour)
barplot(desdata$IHV_24)

desdata$OREhour <- as.factor(desdata$OREhour)
g <- ggplot(desdata, aes(desdata$OREhour, desdata$IHV_24))
g + geom_boxplot(varwidth=T, fill="steelblue") + 
    labs(title="Box plot", 
         subtitle="Ventilation duration depending on time of arrival in CTICU",
         x="Time of Arrival in CTICU",
         y="Ventilation duration" )

gg <- ggplot(desdata, aes(desdata$period, desdata$IHV_24))
gg + geom_boxplot(varwidth=T, fill="plum") + 
    labs(title="Box plot", 
         subtitle="Ventilation duration depending on time of arrival in CTICU",
         x="Time of Arrival in CTICU",
         y="Ventilation duration" )
```



```{r}

par(mfrow=c(1,1))
hist(desdata$IHV_24[desdata$period == "P1"], main = "Histogram of Ventilation Duration in Day Shift", xlab = "Ventilation Duration for Patients Extubated within 24 hours")
hist(desdata$IHV_24[desdata$period == "P2"], main = "Histogram of Ventilation Duration in Night Shift", xlab = "Ventilation Duration for Patients Extubated within 24 hours")

```
```{r}
g1 <- ggplot(desdata, aes(IHV_24, fill=period))

g1 + geom_histogram()

g1 + geom_histogram(position = ,
                   binwidth = 2, 
                   col="black", 
                   size=.1) +  # change binwidth
  labs(title="Histogram with Auto Binning", 
       subtitle="Engine Displacement across Vehicle Classes")  
```
```{r}
data <- desdata %>% na.omit(IHV_24) %>% group_by()
library(scales)
 ggplot(data, aes(IHV_24)) + 
          geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") + 
          scale_y_continuous(labels=scales::percent) +
          ylab("relative frequencies") +
          facet_grid(~period)
         
```

```{r logistic regression}
glmdata <- desdata %>% 
  mutate(period = ifelse( period == "P1", 0, 1) ,
                              lung = na.omit(lung),
                              lung = ifelse(lung == "No", "No", "Yes")) 
 
  

simple_logistic_fit <- glm(formula= period ~ IHV_24, family = binomial(link = "logit"), 
    data = glmdata)
summary(simple_logistic_fit)

full_logistic_fit <- glm(formula= period ~ age+
       sex+
       Ethnicity+
       BMI+ 
       PMM + 
       PRM + 
       PPV+
       Reop +
       Urgent +
       Sug_Dur +
       Pri_MI +
       smoker+
       lung+
       RFD +
       PAD,
                           
                           family = binomial(link = "logit"), 
    data = glmdata)
summary(full_logistic_fit)

```

#Secondary outcome des
```{r Hos_LOS descriptive}
desdata$Hos_LOS[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$Hos_LOS[desdata$period == "P1"])
desdata$Hos_LOS[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$Hos_LOS[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$Hos_LOS[desdata$period == "P2"])
desdata$Hos_LOS[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$Hos_LOS %>% na.omit() %>% length()
summary(desdata$Hos_LOS)
desdata$Hos_LOS %>% na.omit() %>% sd()
```

```{r Hos_LOS t}
var.test(desdata$Hos_LOS[desdata$period == "P2"], desdata$Hos_LOS[desdata$period == "P1"])
t.test(x= desdata$Hos_LOS[desdata$period == "P1"], y = desdata$Hos_LOS[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r ICU_LOS descriptive}
desdata$ICU_LOS[desdata$period == "P1"] %>% na.omit() %>% length()
summary(desdata$ICU_LOS[desdata$period == "P1"])
desdata$ICU_LOS[desdata$period == "P1"] %>% na.omit() %>% sd()
desdata$ICU_LOS[desdata$period == "P2"] %>% na.omit() %>% length()
summary(desdata$ICU_LOS[desdata$period == "P2"])
desdata$ICU_LOS[desdata$period == "P2"] %>% na.omit() %>% sd()
desdata$ICU_LOS %>% na.omit() %>% length()
summary(desdata$ICU_LOS)
desdata$ICU_LOS %>% na.omit() %>% sd()
```

```{r ICU_LOS t}
var.test(desdata$ICU_LOS[desdata$period == "P2"], desdata$ICU_LOS[desdata$period == "P1"])
t.test(x= desdata$ICU_LOS[desdata$period == "P1"], y = desdata$ICU_LOS[desdata$period == "P2"], paired = FALSE, var.equal = FALSE, conf.level = 0.95)
```

```{r}
 Reintub, 
       Post_pneu, 
       Post_throm ,
       Post_stroke ,
       Re_ICU , 
       Hos_LOS, 
       ICU_LOS, 
       Mor_disc,
```

